<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Follow on Farcaster</title>
  </head>
  <body style="font-family: sans-serif; text-align: center; margin-top: 80px;">
    <h2>Login ke Farcaster</h2>
    <button id="loginBtn">Sign in with Farcaster</button>
    <div id="userInfo"></div>
    <br />
    <input id="username" placeholder="Masukkan username untuk di-follow" />
    <button id="followBtn" style="display:none;">Follow</button>
    <p id="status"></p>

    <script>
      const CLIENT_ID = "468536e4-a0e8-4673-969d-cfe28cebb84b"; // dari Warpcast Developer
      const REDIRECT_URI = window.location.origin + "/";
      const FARCASTER_AUTH_URL = `https://api.warpcast.com/v2/oauth?response_type=token&client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(
        REDIRECT_URI
      )}&scope=write`;

      document.getElementById("loginBtn").onclick = () => {
        window.location.href = FARCASTER_AUTH_URL;
      };

      // Jika sudah login
      const hash = window.location.hash;
      if (hash.includes("access_token")) {
        const params = new URLSearchParams(hash.replace("#", ""));
        const token = params.get("access_token");
        localStorage.setItem("farcaster_token", token);
        document.getElementById("loginBtn").style.display = "none";
        document.getElementById("followBtn").style.display = "inline";
        document.getElementById("userInfo").innerText = "‚úÖ Sudah login ke Farcaster!";
      }

      document.getElementById("followBtn").onclick = async () => {
        const token = localStorage.getItem("farcaster_token");
        const username = document.getElementById("username").value.trim();
        const status = document.getElementById("status");
        if (!username) return (status.innerText = "Isi username dulu");

        status.innerText = "üîç Mencari user...";
        const userRes = await fetch(
          `https://client.farcaster.xyz/v2/user-by-username?username=${username}`
        );
        const userData = await userRes.json();
        if (!userData.result?.user?.fid)
          return (status.innerText = "‚ùå User tidak ditemukan!");

        const fid = userData.result.user.fid;
        status.innerText = `‚û°Ô∏è Mengirim follow untuk ${username}...`;

        const resFollow = await fetch("https://client.farcaster.xyz/v2/follow-user", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify({ targetFid: fid }),
        });

        if (resFollow.ok) status.innerText = `üéâ Berhasil follow ${username}!`;
        else status.innerText = `‚ö†Ô∏è Gagal follow user.`;
      };
    </script>
  </body>
</html>
